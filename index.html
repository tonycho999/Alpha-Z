<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alpha-Z</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div class="screen">
        <h1 class="title">Alpha-Z</h1>
        <button class="btn btn-primary" onclick="selectDiff('EASY')">EASY (ì´ˆë³´)</button>
        <button class="btn btn-primary" onclick="selectDiff('NORMAL')">NORMAL (ì¤‘ìˆ˜)</button>
        <button class="btn btn-primary" onclick="selectDiff('HARD')">HARD (ê³ ìˆ˜)</button>
        <button class="btn btn-primary" onclick="selectDiff('HELL')">HELL (ê·¹ì•…)</button>
        
        <button class="btn" style="margin-top:20px; background:#444;" onclick="openLeaderboard()">ğŸ† LEADERBOARD</button>
    </div>

    <div id="popup-tute" class="popup-overlay">
        <div class="popup-box">
            <h2 style="color:var(--accent);">HOW TO PLAY</h2>
            <div class="tute-graphic">
                <p>1. ë§‰ëŒ€ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ë¹ˆ ê³³ì— ë†“ìœ¼ì„¸ìš”.</p>
                <p>2. ê°™ì€ ì•ŒíŒŒë²³ì´ ì—°ê²°ë˜ë©´ í•©ì³ì§‘ë‹ˆë‹¤.</p>
                <p style="color:#81c784;">A + A = B</p>
                <p style="color:#64b5f6;">A + A + A = C (ì í”„!)</p>
            </div>
            <button class="btn btn-primary" style="width:100%;" onclick="closeTute()">GAME START</button>
            <div style="margin-top:15px; font-size:0.8rem;">
                <input type="checkbox" id="chk-nomore"> <label for="chk-nomore">ë‹¤ì‹œ ë³´ì§€ ì•Šê¸°</label>
            </div>
        </div>
    </div>

    <div id="popup-rank" class="popup-overlay">
        <div class="popup-box">
            <h2 style="color:var(--accent);">HALL OF FAME</h2>
            <div id="loading-text" style="color:#888;">Loading...</div>
            <div id="rank-list" class="leaderboard-list">
                </div>
            <button class="btn" style="width:100%; margin-top:15px;" onclick="document.getElementById('popup-rank').style.display='none'">CLOSE</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCHQI-CBSLfnBprSyQdgM8kqxSLduhXZXo",
            authDomain: "alpha-z-puzzle.firebaseapp.com",
            projectId: "alpha-z-puzzle",
            storageBucket: "alpha-z-puzzle.firebasestorage.app",
            messagingSenderId: "112629894683",
            appId: "1:112629894683:web:fff49e40044eb4dcf1b2be",
            measurementId: "G-6GJM44TPR3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë§Œë“¤ê¸° ìœ„í•´ windowì— í• ë‹¹
        window.openLeaderboard = async function() {
            document.getElementById('popup-rank').style.display = 'flex';
            const list = document.getElementById('rank-list');
            list.innerHTML = '';
            document.getElementById('loading-text').style.display = 'block';

            try {
                // ì ìˆ˜(ì¸ë±ìŠ¤) ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬, ìƒìœ„ 20ê°œë§Œ
                const q = query(collection(db, "leaderboard"), orderBy("scoreIndex", "desc"), limit(20));
                const querySnapshot = await getDocs(q);
                
                document.getElementById('loading-text').style.display = 'none';
                
                let rank = 1;
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const item = document.createElement('div');
                    item.className = 'rank-item';
                    item.innerHTML = `
                        <span>${rank++}</span>
                        <span>${data.username} <small style="color:#666">(${data.difficulty})</small></span>
                        <span>${data.bestChar}</span>
                    `;
                    list.appendChild(item);
                });

                if(querySnapshot.empty) {
                    list.innerHTML = '<div style="padding:20px; text-align:center; color:#666;">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                }

            } catch (e) {
                console.error("Error fetching leaderboard: ", e);
                list.innerHTML = '<div style="padding:20px; color:red;">ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</div>';
            }
        };
    </script>

    <script>
        // ê¸°ì¡´ ì¼ë°˜ ìŠ¤í¬ë¦½íŠ¸
        window.onload = function() {
            const hide = localStorage.getItem('hideTutorial');
            if(!hide) document.getElementById('popup-tute').style.display = 'flex';
        };
        function closeTute() {
            if(document.getElementById('chk-nomore').checked) localStorage.setItem('hideTutorial', 'true');
            document.getElementById('popup-tute').style.display = 'none';
        }
        function selectDiff(diff) {
            window.location.href = `game.html?diff=${diff}`;
        }
    </script>
</body>
</html>
