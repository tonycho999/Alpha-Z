<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alpha-Z | Shop</title>
    <link rel="icon" type="image/png" href="./favicon.png">
    <link rel="stylesheet" href="./style.css">
    <style>
        .item-card {
            background: #222; border: 1px solid #444; border-radius: 12px;
            padding: 15px; margin-bottom: 10px; display: flex; 
            justify-content: space-between; align-items: center;
        }
        .item-info { text-align: left; }
        .item-name { font-weight: bold; font-size: 1.1rem; color: #fff; display: block; }
        .item-desc { font-size: 0.8rem; color: #aaa; }
    </style>
</head>
<body class="main-bg">
    <div class="screen">
        <h2 style="color:var(--accent); margin-top: 20px;">ITEM SHOP</h2>
        
        <div style="margin-bottom:20px; font-size:1.2rem; font-weight:bold;">
            MY STARS: <span id="shop-stars" style="color:gold;">0</span>
        </div>

        <div style="width:100%; max-width:350px;">
            
            <div class="item-card">
                <div class="item-info">
                    <span class="item-name">üî® HAMMER</span>
                    <span class="item-desc">Remove 1 block</span>
                </div>
                <button class="btn btn-primary" onclick="buyItem('hammer', 1)">1 ‚≠ê</button>
            </div>

            <div class="item-card">
                <div class="item-info">
                    <span class="item-name">‚Ü©Ô∏è UNDO</span>
                    <span class="item-desc">Revert last turn</span>
                </div>
                <button class="btn btn-primary" onclick="buyItem('undo', 2)">2 ‚≠ê</button>
            </div>

            <div class="item-card">
                <div class="item-info">
                    <span class="item-name">üÜô UPGRADE</span>
                    <span class="item-desc">Upgrade lowest block</span>
                </div>
                <button class="btn btn-primary" onclick="buyItem('upgrade', 5)">5 ‚≠ê</button>
            </div>

        </div>

        <hr style="border:0; border-top:1px dashed #444; width:100%; max-width:350px; margin: 20px 0;">

        <div style="background:#222; padding:20px; border-radius:15px; width:100%; max-width:350px; text-align:center; border:1px solid #444; margin-bottom: 20px;">
            <h3 style="margin-top:0;">üì∫ Free Stars</h3>
            <p style="color:#aaa; font-size:0.9rem; margin-bottom:15px;">
                Watch a short ad and get <span style="color:gold; font-weight:bold;">+2 Stars</span>!
            </p>
            <button id="btn-ad-reward" class="btn btn-primary" style="width:100%;">Loading...</button>
        </div>

        <button class="btn" style="background:#555; width:100%; max-width:350px;" onclick="location.href='index.html'">‚¨Ö BACK TO GAME</button>
    </div>

    <script type="module">
        import { AdManager } from "./js/game-data.js";

        const starEl = document.getElementById('shop-stars');
        const btn = document.getElementById('btn-ad-reward');

        // Î≥Ñ Í∞úÏàò Î∂àÎü¨Ïò§Í∏∞
        let currentStars = parseInt(localStorage.getItem('alpha_stars')) || 0;
        function updateStars() {
            if(starEl) starEl.textContent = currentStars;
        }
        updateStars();

        // [ÏïÑÏù¥ÌÖú Íµ¨Îß§ Ìï®Ïàò]
        window.buyItem = function(type, cost) {
            if(currentStars >= cost) {
                if(confirm(`Buy ${type} for ${cost} Stars?`)) {
                    currentStars -= cost;
                    localStorage.setItem('alpha_stars', currentStars);
                    
                    // ÏïÑÏù¥ÌÖú Í∞úÏàò Ï†ÄÏû• (hammer, undo, upgrade)
                    let currentCount = parseInt(localStorage.getItem(`alpha_${type}`)) || 0;
                    localStorage.setItem(`alpha_${type}`, currentCount + 1);
                    
                    updateStars();
                    alert(`Purchased ${type}! (Owned: ${currentCount + 1})`);
                }
            } else {
                alert("Not enough stars!");
            }
        };

        // Í¥ëÍ≥† Î≤ÑÌäº Î°úÏßÅ
        if(btn) {
            if(AdManager.canWatchAd()) {
                btn.textContent = "üì∫ Watch Ad (+2 ‚≠ê)";
                btn.onclick = () => {
                    AdManager.showRewardAd(() => {
                        currentStars += 2;
                        localStorage.setItem('alpha_stars', currentStars);
                        updateStars();
                        alert("You got 2 Stars!");
                    });
                };
            } else {
                btn.disabled = true;
                btn.textContent = "No Ads Available";
            }
        }
    </script>
</body>
</html>
