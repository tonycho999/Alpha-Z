<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alpha-Z | Shop</title>
    <link rel="icon" type="image/png" href="./favicon.png">
    <link rel="stylesheet" href="./style.css">
    <style>
        .item-card { background: #222; border: 1px solid #444; border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .item-info { text-align: left; }
        .item-name { font-weight: bold; font-size: 1.1rem; color: #fff; display: block; }
        .item-desc { font-size: 0.8rem; color: #aaa; }
    </style>
</head>
<body class="main-bg">
    <div class="screen">
        <h2 style="color:var(--accent); margin-top: 20px;">ITEM SHOP</h2>
        <div style="margin-bottom:20px; font-size:1.2rem; font-weight:bold;">
            MY STARS: <span id="shop-stars" style="color:gold;">0</span>
        </div>

        <div style="width:100%; max-width:350px;">
            <div class="item-card">
                <div class="item-info"><span class="item-name">üî® HAMMER</span><span class="item-desc">Remove 1 block</span></div>
                <button class="btn btn-primary" onclick="playBtnSound(); buyItem('hammer', 1)">1 ‚≠ê</button>
            </div>
            <div class="item-card">
                <div class="item-info"><span class="item-name">üîÑ REFRESH</span><span class="item-desc">New Hand blocks</span></div>
                <button class="btn btn-primary" onclick="playBtnSound(); buyItem('refresh', 1)">1 ‚≠ê</button>
            </div>
            <div class="item-card">
                <div class="item-info"><span class="item-name">üÜô UPGRADE</span><span class="item-desc">Upgrade lowest block</span></div>
                <button class="btn btn-primary" onclick="playBtnSound(); buyItem('upgrade', 5)">5 ‚≠ê</button>
            </div>
        </div>

        <hr style="border:0; border-top:1px dashed #444; width:100%; max-width:350px; margin: 20px 0;">

        <div id="ad-section" style="background:#222; padding:20px; border-radius:15px; width:100%; max-width:350px; text-align:center; border:1px solid #444; margin-bottom: 20px;">
            <h3 style="margin-top:0;">üì∫ Free Stars</h3>
            <p style="color:#aaa; font-size:0.9rem; margin-bottom:15px;">
                Watch a short ad and get <span style="color:gold; font-weight:bold;">+2 Stars</span>!
            </p>
            <button id="btn-ad-reward" class="btn btn-primary" style="width:100%;" onclick="playBtnSound()">Loading...</button>
        </div>

        <button class="btn" style="background:#555; width:100%; max-width:350px;" onclick="playBtnSound(); location.href='/'">‚¨Ö BACK TO GAME</button>
    </div>

    <div style="display:none;">
        <audio id="s-button" src="./assets/button.mp3"></audio>
    </div>
    
    <script>
        // Inline sound function for immediate availability
        window.playBtnSound = function() {
            var audio = document.getElementById('s-button');
            if(audio) { 
                audio.currentTime = 0; 
                audio.play().catch(e=>{}); 
            }
        };
    </script>

    <script type="module">
        import { AdManager, checkAdmin } from "./js/game-data.js";

        const starEl = document.getElementById('shop-stars');
        const btn = document.getElementById('btn-ad-reward');
        const adSection = document.getElementById('ad-section');
        
        let currentStars = parseInt(localStorage.getItem('alpha_stars')) || 0;
        
        // Admin Check
        const savedName = localStorage.getItem('alpha_username');
        if(savedName) checkAdmin(savedName);
        const isAdmin = localStorage.getItem('alpha_admin') === 'true';

        function updateStars() { if(starEl) starEl.textContent = currentStars; }
        updateStars();

        window.buyItem = function(type, cost) {
            if(currentStars >= cost) {
                if(confirm(`Buy ${type} for ${cost} Stars?`)) {
                    currentStars -= cost;
                    localStorage.setItem('alpha_stars', currentStars);
                    
                    let items = { refresh:0, hammer:0, upgrade:0 };
                    try { items = JSON.parse(localStorage.getItem('alpha_items')) || items; } catch(e){}
                    
                    items[type] = (items[type] || 0) + 1;
                    localStorage.setItem('alpha_items', JSON.stringify(items));
                    
                    updateStars();
                    alert(`Purchased ${type}!`);
                }
            } else { alert("Not enough stars!"); }
        };

        // Logic to hide ad section for Admins
        if(btn) {
            if(isAdmin) {
                // If admin, hide the entire ad section
                if(adSection) adSection.style.display = 'none';
            } else {
                // Regular User
                btn.textContent = "üì∫ Watch Ad (+2 ‚≠ê)";
                btn.onclick = () => {
                    playBtnSound();
                    AdManager.showRewardAd(() => {
                        currentStars += 2;
                        localStorage.setItem('alpha_stars', currentStars);
                        updateStars();
                        alert("You got 2 Stars!");
                    });
                };
            }
        }
    </script>
</body>
</html>
